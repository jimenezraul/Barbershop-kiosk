{% extends 'user_profile/base.html' %}
{% load static %}
{% block javascript %}
<script>
  $(function () {

    /* SCRIPT TO OPEN THE MODAL WITH THE PREVIEW */
    $("#id_file").change(function () {
      if (this.files && this.files[0]) {
        var reader = new FileReader();
        reader.onload = function (e) {
          $("#image").attr("src", e.target.result);
          $("#modalCrop").modal("show");
        }
        reader.readAsDataURL(this.files[0]);
      }
    });

    /* SCRIPTS TO HANDLE THE CROPPER BOX */
    var $image = $("#image");
    var cropBoxData;
    var canvasData;
    $("#modalCrop").on("shown.bs.modal", function () {
      $image.cropper({
        viewMode: 1,
        aspectRatio: 1 / 1,
        minCropBoxWidth: 200,
        minCropBoxHeight: 200,
        ready: function () {
          $image.cropper("setCanvasData", canvasData);
          $image.cropper("setCropBoxData", cropBoxData);
        }
      });
    }).on("hidden.bs.modal", function () {
      cropBoxData = $image.cropper("getCropBoxData");
      canvasData = $image.cropper("getCanvasData");
      $image.cropper("destroy");
    });

    $(".js-zoom-in").click(function () {
      $image.cropper("zoom", 0.1);
    });

    $(".js-zoom-out").click(function () {
      $image.cropper("zoom", -0.1);
    });

    /* SCRIPT TO COLLECT THE DATA AND POST TO THE SERVER */
    $(".js-crop-and-upload").click(function () {
      var cropData = $image.cropper("getData");
      $("#id_x").val(cropData["x"]);
      $("#id_y").val(cropData["y"]);
      $("#id_height").val(cropData["height"]);
      $("#id_width").val(cropData["width"]);
      $("#formUpload").submit();
    });

  });
</script>
<script>
  $(".fa-camera").click(function () {
    $("input[type='file']").trigger('click');
  });

  $('input[type="file"]').on('change', function () {
    var val = $(this).val();
    $(this).siblings('span').text(val);
  })
</script>
{% endblock %}
{% block content %}
<section>
  <div class="container">
    <div class="row d-flex justify-content-center align-items-center profile-top-row shadow">
      <div class="d-none d-md-block col-12 col-md-6 heading-col">
        <h4 class="text-center text-dark" id="welcome">Hello {{ barbers.barber}}!
        </h4>

      </div>
      {% if not barbers.file %}
      <div class="col-12 text-center pic-col"><i class="icon-red fas fa-user-circle pl-1 pr-1 shadow"></i></div>
      {% else %}
      <div class="col-12 text-center pic-col"><img class="rounded-circle border-white shadow profile-image"
          src="{{ barbers.file.url }}" height="200px" width="200px"></div>
      {% endif %}



      <div class="col-auto back-col"><a href="{% url 'barbershop-barberprolist' %}"><i
            class="fas fa-arrow-circle-left"></i></a></div>
      <div id="myCompleted" class="col-auto client-complete"><i class="fas fa-users"></i></div>
      
      {% if completed.count == 0 %}
      <div>
        <p></p>
      </div>
      {% else %}
      <span class="client-noti badge badge-light">{{ completed.count }}</span>
      {% endif %}

      <div id="myBtn" class="col-auto barber_noti"><i class="fas fa-bell"></i></div>
      {% if anniversary.count == 0 %}

      {% endif %}
      {% for anni in anniversary %}
      {%if anni.id == barbers.id %}

      {% else %}
      <span class="barber-count-noti badge badge-light">{{anniversary.count}}</span>
      {% endif %}
      {% endfor %}


      <div id="outFrame">
        <div class="container">
          <div class="row d-flex justify-content-center">
            <div class="col-12">
              <div id="barberNoti" class="barbernoti col-12 justify-content-center align-content-center shadow">
                <div role="menu"
                  class="col-11 col-sm-10 col-md-6 col-lg-5 p-0 dropdown-menu dropdown-menu-right show dropdown-list dropdown-menu-right animated--grow-in">
                  <span class="close pr-2">&times;</span>
                  <h6 class="text-white text-center dropdown-header rounded">Notifications</h6>
                  <div class="col-12">
                    {% if anniversary.count == 0 %}
                    <p class="text-center mt-2">No Notifications</p>
                    {% endif %}
                    {% if anniversary != 0 %}
                    {% for a in anniversary %}
                    {%if a.id == barbers.id %}
                    {% else %}
                    <div class="d-flex justify-content-center align-content-center align-items-center">
                      <div class="col-2 text-center p-0 beer"><img class="rounded-circle" src="{{ a.file.url }}" alt="">
                      </div>

                      <div class="col-10 mt-2 border-bottom">
                        <p class="font-weight-bold m-0 ">Congratulate {{ a.barber }} for another year at the BarberShop!
                        </p>
                        <p class="text-center border gradient p-1 text-white pb-2 rounded mt-2"><small>Celebrating
                            {{ a.years_in_shop }} years today!</small></p>
                      </div>
                    </div>
                    {% endif %}
                    {% endfor %}
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div id="outOfFrame">
        <div class="container">
          <div class="row d-flex justify-content-center">
            <div class="col-12">
              <div id="barberCompleted" class="barbernoti col-12 justify-content-center align-content-center shadow">
                <div role="menu"
                  class="col-11 col-sm-10 col-md-6 col-lg-5 p-0 dropdown-menu dropdown-menu-right show dropdown-list dropdown-menu-right animated--grow-in">
                  <span class="close2 pr-2">&times;</span>
                  <h6 class="text-white text-center dropdown-header rounded">Customers Completed</h6>
                  <div class="col-12">
                    {% if completed.count == 0 %}
                    <p class="text-center mt-2">No Customers</p>
                    {% endif %}
                    {% if completed != 0 %}
                    {% for complete in completed %}
                    <div class="d-flex justify-content-center align-content-center align-items-center">
                      

                      <div class="col-12 mt-2 border-bottom">
                        <p class=" m-0 mb-2 text-center">Client: <span class="font-weight-bold">{{ complete.name }}</span> | Completed At: <span class="font-weight-bold">{{ complete.completed_time}}</span></p>
                      </div>
                    </div>
                    {% endfor %}
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>



      <div class="col-auto heading-col">
        {% for message in messages %}
        <div class="row d-flex justify-content-center align-items-center align-content-center">
          <div id="mydiv" class="mt-2 col-12 alert alert-{{ message.tags }} fade show message text-center"
            id="success-alert" role="alert">
            {{ message }}
          </div>
        </div>

        {% endfor %}
      </div>
      <form action="{% url 'barberphoto' barbers.id %}" method="post" enctype="multipart/form-data" id="formUpload">
        {% csrf_token %}
        <div class="col-auto camera-col"><i class="fas fa-camera shadow"></i>{{  photoform }}
        </div>
      </form>

    </div>
  </div>
</section>
<div>

  <!-- MODAL TO CROP THE IMAGE -->
  <div class="modal fade" id="modalCrop">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <h4 class="modal-title p-1">Close</h4>
          </button>
        </div>
        <div class="modal-body">
          <img src="" id="image" style="max-width: 100%;">
        </div>
        <div class="modal-footer">
          <div class="btn-group pull-left" role="group">
            <button type="button" class="btn btn-default js-zoom-in">
              <span class="glyphicon glyphicon-zoom-in"></span>
            </button>
            <button type="button" class="btn btn-default js-zoom-out">
              <span class="glyphicon glyphicon-zoom-out"></span>
            </button>
          </div>
          <button type="button" class="btn btn-danger badge-pill" data-dismiss="modal">Nevermind</button>
          <button type="button" class="btn btn-primary badge-pill js-crop-and-upload">Crop and upload</button>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid shadow">
    <div class="row row-2">
      <div class="col">
        <div></div>
      </div>
    </div>
  </div>
</div>
<div class="">
  <div class="container">
    <div class="row d-flex justify-content-center card-margin">
      <div class="col-12 col-sm-12 col-md-4 col-lg-4 col-xl-4 mb-4 p-0">
        <div class="card shadow">
          <h5 class="card-header">Barber's Info</h5>
          <div class="card-body">

            {% if hire.day == todays_date.day and hire.month == todays_date.month %}
            <div class="aniversary p-2 rounded text-light mb-3">
              <h4 class="text-center">{{ happy_hire_day }}</h4>
              <p class="text-center mb-2"><small>{{ happy_hire_greeting }}</small></p>
            </div>
            {% endif %}
            <h5>Name: <span class='pro-info'>{{ barbers.barber }}</span></h5>
            {% if barbers.available == False %}
            <h5>Available: <span class='pro-info no font-weight-bold'>No</span></h5>
            {% else %}
            <h5>Available: <span class='pro-info yes font-weight-bold'>Yes</span></h5>
            {% endif %}
            <h5>Phone #: <span class='pro-info'>({{ area_code }}) {{ first_3_number }}-{{ last_4_number }}</span></h5>
            <h5>License #: <span class='pro-info'>{{ barbers.license_num }}</span></h5>
            <h5>Hire Date: <span class='pro-info'>{{ barbers.hire_date }}</span></h5>
            {% if not years_in_shop %}
            <h5>Years in the Shop: <span class='pro-info'>0 Years</span></h5>
            {% else %}
            <h5>Years in the Shop: <span class='pro-info'>{{ years_in_shop }} Years</span></h5>
            {% endif %}
            <form action="{% url 'barber_status' barbers.id %}">
              {% csrf_token %}
              <button class="btn btn-primary btn-border" type="submit">Update Status</button>
            </form>
          </div>
        </div>

      </div>
      <div class="col-12 col-sm-12 col-md-8 col-lg-8 col-xl-8 mb-4">
        <div class="card shadow">
          <div class="col-12 card-header d-flex">
            <h5 class="m-0 col-4 text-center">Client</h5>
            <h5 class="m-0 col-4 text-center">Barber</h5>
            <svg class="col-2" width="30px" height="30px" id="Layer_1" enable-background="new 0 0 511.892 511.892"
              height="512" viewBox="0 0 511.892 511.892" width="512" xmlns="http://www.w3.org/2000/svg">
              <path
                d="m353.407 487.019.947-6.125.092-44.792h-20l-.062 30.187 3.206 20.73c1.358 8.783-.94 17.285-5.757 23.967h27.33c-4.816-6.683-7.115-15.184-5.756-23.967z" />
              <path
                d="m256.739 428.134c-4.25-5.063-6.03-11.701-4.884-18.212l9.76-55.443v-90.871h9.492v36.954l11.47-65.157.022-.125.025-.125c3.643-18.406 19.84-31.782 38.561-31.892-13.646-8.681-22.725-23.928-22.725-41.264 0-26.955 21.929-48.884 48.884-48.884 2.287 0 4.534.17 6.739.476l-20.569-16.007c-7.33-5.704-16.482-8.91-25.771-9.026-11.37-.137-62.543.001-78.833 0-21.444.218-40.781 12.95-49.265 32.647l-8.75 20.315-16.64-18.449c-1.171.703-2.394 1.318-3.667 1.828-3.078 1.234-6.326 1.859-9.654 1.859-3.849 0-7.596-.85-10.998-2.438-2.201 5.646-6.349 10.433-11.813 13.397l44.696 49.554c8.909 9.877 25.137 7.265 30.43-5.024l20.048-46.549c1.089-2.528 2.535-4.702 4.55-6.419-.027 20.653.014 299.156 0 310.052 0 12.142 9.643 21.984 21.785 21.984s21.984-9.843 21.984-21.984v-6.872c-1.806-1.184-3.454-2.63-4.877-4.325z" />
              <ellipse cx="266.366" cy="37.969" rx="37.969" ry="37.969"
                transform="matrix(.383 -.924 .924 .383 129.353 269.529)" />
              <path
                d="m276.689 436.102 9.113 58.926c1.683 10.884 11.872 18.308 22.712 16.628 10.863-1.68 18.308-11.849 16.628-22.712l-8.172-52.842z" />
              <path
                d="m374.027 436.102-8.172 52.842c-1.68 10.864 5.765 21.032 16.628 22.712 10.86 1.681 21.032-5.764 22.712-16.628l9.113-58.926z" />
              <path
                d="m396.089 237.485c-2.557-12.918-13.889-22.227-27.058-22.227h-47.613c-13.179 0-24.463 9.299-27.022 22.227l-30.722 174.518c-1.111 6.313 3.745 12.099 10.155 12.099h146.645c6.498 0 11.377-5.938 10.115-12.313zm-59.326 45.205c4.502.547 8.111 3.479 9.696 7.43 1.585-3.951 5.193-6.883 9.696-7.43 4.235-.514 8.104 1.166 10.621 4.054 3.708 4.253 10.471 3.85 13.357-.999.025-.042.05-.084.075-.127 1.029 1.777 1.62 3.839 1.62 6.04 0 11.062-12.688 16.55-24.16 15.1-5.043-.637-9.412-3.444-11.208-7.695-1.795 4.251-6.165 7.057-11.208 7.695-11.473 1.45-24.16-4.038-24.16-15.1 0-2.201.592-4.263 1.62-6.04.025.042.049.085.075.127 2.885 4.849 9.649 5.252 13.357.999 2.515-2.888 6.384-4.568 10.619-4.054z" />
              <circle cx="347.343" cy="161.998" r="36.884" />
              <path
                d="m121.684 114.142-.574-11.841 7.762 8.959c5.748 6.635 15.835 7.375 22.49 1.61 6.66-5.769 7.38-15.829 1.61-22.49-5.774-6.665-15.843-7.37-22.49-1.61-1.02.884-1.896 1.886-2.647 2.966l-7.666-8.848-1.8-37.141c-.311-6.422-5.616-11.419-11.977-11.42-.196 0-.392.005-.59.014l1.641 33.858-22.196-25.617c-5.009 4.34-5.552 11.918-1.212 16.927l24.349 28.104.567 11.699c-1.383-.283-2.704-.384-3.963-.322-8.799.425-15.58 7.893-15.153 16.697.427 8.815 7.912 15.582 16.696 15.153 8.763-.426 15.579-7.9 15.153-16.698zm16.656-16.301c1.653-1.433 4.141-1.243 5.563.398 1.427 1.646 1.25 4.135-.398 5.562-1.642 1.423-4.132 1.253-5.563-.398-1.427-1.646-1.25-4.135.398-5.562zm-36.52 17.264c-.105-2.164 1.557-4.024 3.748-4.13.065-.003.129-.005.194-.005 2.087 0 3.833 1.645 3.936 3.751.105 2.175-1.571 4.025-3.748 4.129-.066.003-.131.005-.196.005-2.085.002-3.831-1.634-3.934-3.75z" />
            </svg>
            <svg class="col-2" width="30px" height="30px" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 478.307 478.307"
              style="enable-background:new 0 0 478.307 478.307;" xml:space="preserve">
              <g id="XMLID_91_">
                <path id="XMLID_95_" d="M126.581,93.284c25.745,0,46.63-20.876,46.63-46.637C173.211,20.876,152.326,0,126.581,0
		c-25.778,0-46.663,20.876-46.663,46.647C79.918,72.408,100.802,93.284,126.581,93.284z" />
                <path id="XMLID_94_" d="M376.067,102.27h-17.159c-22.179,0-40.163,17.986-40.163,40.163v16.551l18.655-19.824l-19.185,39.26
		l-66.55,25.941c-10.27,3.998-15.335,15.561-11.346,25.831c3.087,7.888,10.613,12.71,18.593,12.71c2.416,0,4.862-0.443,7.247-1.371
		l73.81-28.77c4.66-1.814,8.48-5.329,10.677-9.826l22.614-46.288l-8.276,53.294c-1.075,6.95-5.782,12.436-11.892,14.837
		l-7.325,2.853l-27.009,10.528l0.016,216.211c0,13.224,10.723,23.939,23.939,23.939c5.454,0,10.441-1.9,14.463-4.987
		c-3.07-5.657-4.987-12.047-4.987-18.951V311.709h15.96v142.659c0,13.224,10.721,23.939,23.939,23.939
		c13.216,0,23.938-10.715,23.938-23.939l0.203-311.935C416.23,120.256,398.244,102.27,376.067,102.27z" />
                <path id="XMLID_93_" d="M367.479,93.284c25.777,0,46.661-20.876,46.661-46.637C414.14,20.876,393.256,0,367.479,0
		c-25.747,0-46.631,20.876-46.631,46.647C320.848,72.408,341.732,93.284,367.479,93.284z" />
                <path id="XMLID_92_" d="M175.845,178.419l-17.659-36.135l17.129,17.472v-17.331c0-22.178-17.985-40.163-40.162-40.163h-17.159
		c-22.179,0-40.163,17.985-40.163,40.163v141.021L62.182,452.147c-1.231,13.17,8.447,24.828,21.617,26.052
		c0.748,0.07,1.495,0.101,2.243,0.101c12.219,0,22.661-9.313,23.799-21.726l13.435-144.87h11.393l41.488,149.079
		c2.945,10.589,12.577,17.524,23.05,17.524c2.119,0,4.286-0.289,6.438-0.881c12.732-3.544,20.182-16.746,16.644-29.486
		l-46.973-168.81v-40.966l-27.025-10.534l-7.652-2.984c-6.452-2.511-10.69-8.299-11.563-14.705l-6.749-50.153l21.087,43.147
		c2.197,4.497,6.017,8.012,10.677,9.826l73.811,28.77c0.141,0.055,0.281,0.03,0.421,0.078c-1.075-1.777-2.089-3.616-2.867-5.627
		c-4.911-12.6-2.089-26.183,5.984-35.892L175.845,178.419z" />
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
              <g>
              </g>
            </svg>
          </div>
          <div class="barber-clients">
            {% for client in clients %}
            <div class="p-2 border-bottom card-body d-flex text-center">
              <div class="col-4">
                <h5>{{ client.name }}</h5>
              </div>
              <div class="col-4">
                <h5>{{ client.barber }}</h5>
              </div>
              <div class="col-2">
                <form action="{% url 'barbershop-status' client.id barbers.id %}">
                  {% csrf_token %}
                  <button class="completed-btn red" type="submit"><i class="fas fa-check"></i></button>
                </form>
              </div>
              <div class="col-2">
                <form action="{% url 'barbershop-complete' client.id barbers.id %}">
                  {% csrf_token %}
                  <button class="completed-btn red" type="submit"><i class="fas fa-check"></i></button>
                </form>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

    </div>
  </div>
</div>
</div>
</div>


{% endblock %}